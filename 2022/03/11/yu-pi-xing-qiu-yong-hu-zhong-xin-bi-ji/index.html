<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>鱼皮星球用户中心笔记 | 墨苒孤</title><meta name="author" content="RanGuMo"><meta name="copyright" content="RanGuMo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.初始化项目（前端项目）# 使用 npm npm i @ant-design&#x2F;pro-cli -g pro create MyCenterApp  #依赖安装的目录（推荐第一种） cd MyCenterApp &amp;&amp; yarn   &#x2F;&#x2F; 或 cd MyCenterApp &amp;&amp; npm install  小米饭插件的构建，这里请运行下面的命令，且保证是在umi@3项目">
<meta property="og:type" content="article">
<meta property="og:title" content="鱼皮星球用户中心笔记">
<meta property="og:url" content="http://rangumo.github.io/2022/03/11/yu-pi-xing-qiu-yong-hu-zhong-xin-bi-ji/index.html">
<meta property="og:site_name" content="墨苒孤">
<meta property="og:description" content="1.初始化项目（前端项目）# 使用 npm npm i @ant-design&#x2F;pro-cli -g pro create MyCenterApp  #依赖安装的目录（推荐第一种） cd MyCenterApp &amp;&amp; yarn   &#x2F;&#x2F; 或 cd MyCenterApp &amp;&amp; npm install  小米饭插件的构建，这里请运行下面的命令，且保证是在umi@3项目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://source.fomal.cc/img/dm7.webp">
<meta property="article:published_time" content="2022-03-10T16:08:56.000Z">
<meta property="article:modified_time" content="2023-03-04T04:03:05.699Z">
<meta property="article:author" content="RanGuMo">
<meta property="article:tag" content="前端项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://source.fomal.cc/img/dm7.webp"><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/67958995?v=4"><link rel="canonical" href="http://rangumo.github.io/2022/03/11/yu-pi-xing-qiu-yong-hu-zhong-xin-bi-ji/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: RanGuMo","link":"链接: ","source":"来源: 墨苒孤","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '鱼皮星球用户中心笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-04 12:03:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://source.fomal.cc/img/dm7.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">墨苒孤</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">鱼皮星球用户中心笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-10T16:08:56.000Z" title="发表于 2022-03-11 00:08:56">2022-03-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-04T04:03:05.699Z" title="更新于 2023-03-04 12:03:05">2023-03-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE/">前端项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="鱼皮星球用户中心笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-初始化项目（前端项目）"><a href="#1-初始化项目（前端项目）" class="headerlink" title="1.初始化项目（前端项目）"></a>1.初始化项目（前端项目）</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"># 使用 npm
npm i @ant-design/pro-cli -g
pro create MyCenterApp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214223316576.png" alt="image-20230214223316576"></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">#依赖安装的目录（推荐第一种）
cd MyCenterApp &amp;&amp; yarn  
// 或
cd MyCenterApp &amp;&amp; npm install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214223431841.png" alt="image-20230214223431841"></p>
<p>小米饭插件的构建，这里请运行下面的命令，且保证是在<code>umi@3</code>项目中  （重要的事情说三遍文件夹<code>MyCenterApp</code>）</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">yarn add @umijs/preset-ui -D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214221259898.png" alt="image-20230214221259898"></p>
<p>运行项目</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214224404805.png" alt="image-20230214224404805"></p>
<ol>
<li><p><strong>因为我们没有写后端，所有的数据全部是假的，是MOCK模拟出来的，当MOCK：none就登录不进去了</strong></p>
</li>
<li><p><strong>start和start:dev的区别在于前者有造好的假数据，包括写死的的用户名和密码。</strong></p>
</li>
<li><p><strong>开启umi UI帮助我们自动生成代码，在terminal执行yarn add @umijs/preset-ui -D ，就是下面图片中的米饭插件</strong></p>
</li>
</ol>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214224020891.png" alt="image-20230214224020891"></p>
<h2 id="2-项目瘦身"><a href="#2-项目瘦身" class="headerlink" title="2.项目瘦身"></a>2.项目瘦身</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">1. 删除国际化 

  执行 i18n-remove 脚本

  删除项目路径下 src/locales 文件夹 

2. 删除项目路径下 src/e2e 文件夹 

  e2e 文件夹里面定义的是一系列测试流程 

3. 若前面有使用 umi ui 添加页面，可把该页面删除 
   注意：需要在路径为 config/routes.ts 的文件夹下，删除对应的路由规则

4.  删除项目路径下 src/services/swagger 文件夹 
  swagger 文件夹里面定义了一系列后台接口程序 

5. 删除项目路径下 config/oneapi.json 文件 
  oneapi.json 定义了整个项目用到的一些接口 

6. 删除项目根路径下 tests 文件夹 
  tests 文件夹主要是和测试相关的 

7. 删除项目根路径下 jest.config.js 文件 
  jest.config.js 测试相关的配置文件 

8. 删除项目根路径下 playwright.config.ts 文件  
  playwright.config.ts -&gt; 自动化测试工具，帮你在火狐或谷歌自动测试，不用真实地打开浏览 器就能测试<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214225407384.png" alt="image-20230214225407384"></p>
<h2 id="3-登录页面"><a href="#3-登录页面" class="headerlink" title="3.登录页面"></a>3.登录页面</h2><ol>
<li><p>修改底部版权信息</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214234846020.png" alt="image-20230214234846020"></p>
</li>
</ol>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214234643619.png" alt="image-20230214234643619"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214234752116.png" alt="image-20230214234752116"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214235011455.png" alt="image-20230214235011455"></p>
<ol>
<li><p>​    把 “/logo.svg” 改为 {SYSTEM_LOGO}，这⾥要导⼊⼀下，根据提示或使⽤快捷键导入SYSTEM_LOGO </p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214235335123.png" alt="image-20230214235335123"></p>
</li>
</ol>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214235728247.png" alt="image-20230214235728247"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214235924847.png" alt="image-20230214235924847"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215000106066.png" alt="image-20230215000106066"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215000252188.png" alt="image-20230215000252188"></p>
<ol>
<li><p>对接后端接口</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215000941017.png" alt="image-20230215000941017"></p>
<p>点击username按f2重构为userAccunt，点击password按f2重构为userPassword(webstrom快捷键<br>shift+f6重构)</p>
</li>
</ol>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215001046689.png" alt="image-20230215001046689"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215001320705.png" alt="image-20230215001320705"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215001410079.png" alt="image-20230215001410079"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215001602256.png" alt="image-20230215001602256"></p>
<p>解决跨域问题</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215001750997.png" alt="image-20230215001750997"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215001939782.png" alt="image-20230215001939782"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215002223893.png" alt="image-20230215002223893"></p>
<p>给密码多加⼀个⻓度校验</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215003156306.png" alt="image-20230215003156306"></p>
<p>这⾥改成user，如果user存在的话，就显示登录成功，并且设置⽤户的登录状态为user</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215002733758.png" alt="image-20230215002733758"></p>
<p>以<code>start:dev</code>  启动 测试接口</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215002957025.png" alt="image-20230215002957025"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215003419675.png" alt="image-20230215003419675"></p>
<p>完整的登录页面如下：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">import Footer from '@/components/Footer';
import { login } from '@/services/ant-design-pro/api';
import {
  LockOutlined,
  UserOutlined,
} from '@ant-design/icons';
import {
  LoginForm,
  ProFormCheckbox,
  ProFormText,
} from '@ant-design/pro-components';
import {Alert, Divider, message, Space, Tabs} from 'antd';
import React, { useState } from 'react';
import { history, useModel } from 'umi';
import styles from './index.less';
import {PLANET_LINK, SYSTEM_LOGO} from "@/constants";

import {Link} from "@umijs/preset-dumi/lib/theme";

const LoginMessage: React.FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>{</span>
  <span class="token attr-name"><span class="token namespace">content:</span></span> <span class="token attr-name">string;</span>
<span class="token attr-name">}</span><span class="token punctuation">&gt;</span></span> = ({ content }) =&gt; (
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Alert</span>
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span></span></span></span>
      <span class="token attr-name"><span class="token namespace">marginBottom:</span></span> <span class="token attr-name">24,</span>
    <span class="token attr-name">}}</span>
    <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{content}</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span>
    <span class="token attr-name">showIcon</span>
  <span class="token punctuation">/&gt;</span></span>
);
const Login: React.FC = () =&gt; {
  const [userLoginState, setUserLoginState] = useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>API.LoginResult</span><span class="token punctuation">&gt;</span></span>({});
  const [type, setType] = useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>('account');
  const { initialState, setInitialState } = useModel('@@initialState');
  const fetchUserInfo = async () =&gt; {
    const userInfo = await initialState?.fetchUserInfo?.();
    if (userInfo) {
      await setInitialState((s) =&gt; ({
        ...s,
        currentUser: userInfo,
      }));
    }
  };
  const handleSubmit = async (values: API.LoginParams) =&gt; {
    try {
      // 登录
      // const msg = await login({
        const user = await login({
        ...values,
        type,
      });
      // if (msg.status === 'ok') {
        if (user) {
        const defaultLoginSuccessMessage = '登录成功！';
        message.success(defaultLoginSuccessMessage);
        await fetchUserInfo();
        /** 此方法会跳转到 redirect 参数所在的位置 */
        if (!history) return;
        const { query } = history.location;
        const { redirect } = query as {
          redirect: string;
        };
        history.push(redirect || '/');
        return;
      }
      // console.log(msg);
      // 如果失败去设置用户错误信息
      // setUserLoginState(msg);
      setUserLoginState(user);
    } catch (error) {
      const defaultLoginFailureMessage = '登录失败，请重试！';
      message.error(defaultLoginFailureMessage);
    }
  };
  const { status, type: loginType } = userLoginState;
  return (
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.container}</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.content}</span><span class="token punctuation">&gt;</span></span>
        &lt;LoginForm
          // logo={<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/logo.svg<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>}
          logo={<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{SYSTEM_LOGO}</span> <span class="token punctuation">/&gt;</span></span>}

          // title="Ant Design"
          // subTitle={'Ant Design 是西湖区最具影响力的 Web 设计规范'}
          title="编程导航知识星球"
          subTitle={<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{PLANET_LINK}</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noreferrer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>最好的编程学习圈子<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>}
          initialValues={{
            autoLogin: true,
          }}
          // actions={[
          //   '其他登录方式 :',
          //   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AlipayCircleOutlined</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AlipayCircleOutlined<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.icon}</span> <span class="token punctuation">/&gt;</span></span>,
          //   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TaobaoCircleOutlined</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TaobaoCircleOutlined<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.icon}</span> <span class="token punctuation">/&gt;</span></span>,
          //   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WeiboCircleOutlined</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>WeiboCircleOutlined<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.icon}</span> <span class="token punctuation">/&gt;</span></span>,
          // ]}
          onFinish={async (values) =&gt; {
            await handleSubmit(values as API.LoginParams);
          }}
        &gt;
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Tabs</span> <span class="token attr-name">activeKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{type}</span> <span class="token special-attr"><span class="token attr-name">onChange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token punctuation">{</span>setType<span class="token punctuation">}</span></span></span></span><span class="token punctuation">&gt;</span></span>
            &lt;Tabs.TabPane key="account" tab={'账户密码登录'} /&gt;
            {/*&lt;Tabs.TabPane key="mobile" tab={'手机号登录'} /&gt;*/}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Tabs</span><span class="token punctuation">&gt;</span></span>

          {status === 'error' &amp;&amp; loginType === 'account' &amp;&amp; (
            // &lt;LoginMessage content={'错误的用户名和密码(admin/ant.design)'} /&gt;
            &lt;LoginMessage content={'错误的用户名和密码'} /&gt;
          )}
          {type === 'account' &amp;&amp; (
            &lt;&gt;
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProFormText</span>
                <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userAccount<span class="token punctuation">"</span></span>
                <span class="token attr-name">fieldProps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{</span>
                  <span class="token attr-name"><span class="token namespace">size:</span></span> <span class="token attr-name">'large',</span>
                  <span class="token attr-name"><span class="token namespace">prefix:</span></span> <span class="token attr-name">&lt;UserOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,
                }}
                // placeholder={'用户名: admin or user'}
                placeholder={'请输⼊账号'}
                rules={[
                  {
                    required: true,
                    message: '账号是必填项！',
                  },

                ]}
              /&gt;
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProFormText.Password</span>
                <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userPassword<span class="token punctuation">"</span></span>
                <span class="token attr-name">fieldProps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{</span>
                  <span class="token attr-name"><span class="token namespace">size:</span></span> <span class="token attr-name">'large',</span>
                  <span class="token attr-name"><span class="token namespace">prefix:</span></span> <span class="token attr-name">&lt;LockOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,
                }}
                // placeholder={'密码: ant.design'}
                placeholder={'请输⼊密码'}
                rules={[
                  {
                    required: true,
                    message: '密码是必填项！',
                  },
                  {
                    min:8,
                    type:'string',
                    message:'长度不能小于8'
                  }
                ]}
              /&gt;
            &lt;/&gt;
          )}

          {/*{status === 'error' &amp;&amp; loginType === 'mobile' &amp;&amp; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LoginMessage</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>验证码错误<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>}*/}
          {/*{type === 'mobile' &amp;&amp; (*/}
          {/*  &lt;&gt;*/}
          {/*    &lt;ProFormText*/}
          {/*      fieldProps={{*/}
          {/*        size: 'large',*/}
          {/*        prefix: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MobileOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,*/}
          {/*      }}*/}
          {/*      name="mobile"*/}
          {/*      placeholder={'请输入手机号！'}*/}
          {/*      rules={[*/}
          {/*        {*/}
          {/*          required: true,*/}
          {/*          message: '手机号是必填项！',*/}
          {/*        },*/}
          {/*        {*/}
          {/*          pattern: /^1\d{10}$/,*/}
          {/*          message: '不合法的手机号！',*/}
          {/*        },*/}
          {/*      ]}*/}
          {/*    /&gt;*/}
          {/*    &lt;ProFormCaptcha*/}
          {/*      fieldProps={{*/}
          {/*        size: 'large',*/}
          {/*        prefix: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LockOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,*/}
          {/*      }}*/}
          {/*      captchaProps={{*/}
          {/*        size: 'large',*/}
          {/*      }}*/}
          {/*      placeholder={'请输入验证码！'}*/}
          {/*      captchaTextRender={(timing, count) =&gt; {*/}
          {/*        if (timing) {*/}
          {/*          return `${count} ${'秒后重新获取'}`;*/}
          {/*        }*/}
          {/*        return '获取验证码';*/}
          {/*      }}*/}
          {/*      name="captcha"*/}
          {/*      rules={[*/}
          {/*        {*/}
          {/*          required: true,*/}
          {/*          message: '验证码是必填项！',*/}
          {/*        },*/}
          {/*      ]}*/}
          {/*      onGetCaptcha={async (phone) =&gt; {*/}
          {/*        const result = await getFakeCaptcha({*/}
          {/*          phone,*/}
          {/*        });*/}
          {/*        if (result === false) {*/}
          {/*          return;*/}
          {/*        }*/}
          {/*        message.success('获取验证码成功！验证码为：1234');*/}
          {/*      }}*/}
          {/*    /&gt;*/}
          {/*  &lt;/&gt;*/}
          {/*)}*/}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
            <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span></span></span></span>
              <span class="token attr-name"><span class="token namespace">marginBottom:</span></span> <span class="token attr-name">24,</span>
            <span class="token attr-name">}}</span>
          <span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Space</span> <span class="token attr-name">split</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{&lt;Divider</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>}&gt;
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProFormCheckbox</span> <span class="token attr-name">noStyle</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>autoLogin<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                自动登录
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ProFormCheckbox</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/register<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>新用户注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>
                <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span></span></span></span>
                  <span class="token attr-name"><span class="token namespace">float:</span></span> <span class="token attr-name">'right',</span>
                <span class="token attr-name">}}</span>
                <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{PLANET_LINK}</span>
                <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span>
                <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noreferrer<span class="token punctuation">"</span></span>
              <span class="token punctuation">&gt;</span></span>
                忘记密码 ?
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Space</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LoginForm</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  );
};
export default Login;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="4-注册页面"><a href="#4-注册页面" class="headerlink" title="4.注册页面"></a>4.注册页面</h2><p>1.编写注册页面</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214231100868.png" alt="image-20230214231100868"></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"># 2.添加路由规则
{ name: '注册', path: '/user/register', component: './user/Register' },<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214231304380.png" alt="image-20230214231304380"></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">3.在添加完组件以及路由之后，输入 http//localhost:8000/user/register ，发现被强制路由至登录页面。此时想到 ant design pro 是一个后台管理系统，在未登录情况下想操作其它页面，势必会被强制路由到登录页面。所以需要修改此逻辑。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>解决方案：修改项目入口文件 src/app.tsx</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214231653668.png" alt="image-20230214231653668"></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">// 添加白名单，登录页面以及注册页面不需要进行强制路由
if(location.pathname === "/user/register"){
return ;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230214231858993.png" alt="image-20230214231858993"></p>
<p>修改注册页面</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215104506262.png" alt="image-20230215104506262"></p>
<p>添加确认密码框</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215104609041.png" alt="image-20230215104609041"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215104649615.png" alt="image-20230215104649615"></p>
<p>然后按ctrl+r把register 中的 登录 全局替换成 注册</p>
<p>把登录按钮改为 注册按钮</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215105111897.png" alt="image-20230215105111897"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215105129562.png" alt="image-20230215105129562"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215105240513.png" alt="image-20230215105240513"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215105356422.png" alt="image-20230215105356422"></p>
<p>回到index.tsx，把 LoginParams 全部替换为 RegisterParams</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215105528458.png" alt="image-20230215105528458"></p>
<p>在提交前写⼀些校验，代码如下：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">const {userPassword,checkPassword} = values;
  //校验
  if(userPassword !== checkPassword){
    message.error("两次输入的密码不一致");
    return;
  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215105904831.png" alt="image-20230215105904831"></p>
<p>还要写⼀个注册⽅法的接口，ctrl+点击login</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215110023342.png" alt="image-20230215110023342"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215110150158.png" alt="image-20230215110150158"></p>
<p>按住ctrl点击 LoginResult （这⾥定义了向后端发送请求之后，前端接收的返回类型）</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215110332405.png" alt="image-20230215110332405"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215110447268.png" alt="image-20230215110447268"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215110721370.png" alt="image-20230215110721370"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215113352754.png" alt="image-20230215113352754"></p>
<p>删除没用的代码（比如一些登录页面的错误提示）</p>
<p>完整的注册页面如下：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">import Footer from '@/components/Footer';
import {register} from '@/services/ant-design-pro/api';
import {
  LockOutlined,
  UserOutlined,
} from '@ant-design/icons';
import {
  LoginForm,
  ProFormText,
} from '@ant-design/pro-components';
import { Alert, message, Tabs } from 'antd';
import React, { useState } from 'react';
import { history } from 'umi';
import styles from './index.less';
import {PLANET_LINK, SYSTEM_LOGO} from "@/constants";
const LoginMessage: React.FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>{</span>
  <span class="token attr-name"><span class="token namespace">content:</span></span> <span class="token attr-name">string;</span>
<span class="token attr-name">}</span><span class="token punctuation">&gt;</span></span> = ({ content }) =&gt; (
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Alert</span>
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span></span></span></span>
      <span class="token attr-name"><span class="token namespace">marginBottom:</span></span> <span class="token attr-name">24,</span>
    <span class="token attr-name">}}</span>
    <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{content}</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span>
    <span class="token attr-name">showIcon</span>
  <span class="token punctuation">/&gt;</span></span>
);
const Register: React.FC = () =&gt; {

  const [type, setType] = useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>('account');

  const handleSubmit = async (values: API.RegisterParams) =&gt; {
    const {userPassword,checkPassword} = values;
    //校验
    if(userPassword !== checkPassword){
      message.error("两次输入的密码不一致");
      return;
    }
    try {
      // 注册
      // const user = await login({
        const id = await register({
        ...values,
        type,
      });
      // if (msg.status === 'ok') {
        if (id&gt;0) {
        const defaultLoginSuccessMessage = '注册成功！';
        message.success(defaultLoginSuccessMessage);

        /** 此方法会跳转到 redirect 参数所在的位置 */
        if (!history) return;
        const { query } = history.location;
          history.push({
            pathname: '/user/login',
            query,
          });
          return;
      }
        // else{
        //   throw new Error(`register error id =${id}`)
        // }
    } catch (error: any) {
      const defaultLoginFailureMessage = '注册失败，请重试！';
      message.error(defaultLoginFailureMessage);
    }
  };

  return (
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.container}</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.content}</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LoginForm</span>

          <span class="token attr-name">submitter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{</span>
            <span class="token attr-name"><span class="token namespace">{searchConfig:</span>{</span>
              <span class="token attr-name"><span class="token namespace">submitText:</span>'注册'</span>
              <span class="token attr-name">}}</span>
          <span class="token attr-name">}</span>
          <span class="token attr-name">logo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{&lt;img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{SYSTEM_LOGO}</span> <span class="token punctuation">/&gt;</span></span>}

          title="编程导航知识星球"
          subTitle={<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{PLANET_LINK}</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noreferrer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>最好的编程学习圈子<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>}
          initialValues={{
            autoLogin: true,
          }}

          onFinish={async (values) =&gt; {
            await handleSubmit(values as API.RegisterParams);
          }}
        &gt;
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Tabs</span> <span class="token attr-name">activeKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{type}</span> <span class="token special-attr"><span class="token attr-name">onChange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token punctuation">{</span>setType<span class="token punctuation">}</span></span></span></span><span class="token punctuation">&gt;</span></span>
            &lt;Tabs.TabPane key="account" tab={'账户密码注册'} /&gt;

          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Tabs</span><span class="token punctuation">&gt;</span></span>

          {status === 'error' &amp;&amp; loginType === 'account' &amp;&amp; (
            // &lt;LoginMessage content={'错误的用户名和密码(admin/ant.design)'} /&gt;
            &lt;LoginMessage content={'错误的用户名和密码'} /&gt;
          )}
          {type === 'account' &amp;&amp; (
            &lt;&gt;
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProFormText</span>
                <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userAccount<span class="token punctuation">"</span></span>
                <span class="token attr-name">fieldProps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{</span>
                  <span class="token attr-name"><span class="token namespace">size:</span></span> <span class="token attr-name">'large',</span>
                  <span class="token attr-name"><span class="token namespace">prefix:</span></span> <span class="token attr-name">&lt;UserOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,
                }}
                // placeholder={'用户名: admin or user'}
                placeholder={'请输⼊账号'}
                rules={[
                  {
                    required: true,
                    message: '账号是必填项！',
                  },

                ]}
              /&gt;
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProFormText.Password</span>
                <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userPassword<span class="token punctuation">"</span></span>
                <span class="token attr-name">fieldProps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{</span>
                  <span class="token attr-name"><span class="token namespace">size:</span></span> <span class="token attr-name">'large',</span>
                  <span class="token attr-name"><span class="token namespace">prefix:</span></span> <span class="token attr-name">&lt;LockOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,
                }}
                // placeholder={'密码: ant.design'}
                placeholder={'请输⼊密码'}
                rules={[
                  {
                    required: true,
                    message: '密码是必填项！',
                  },
                  {
                    min:8,
                    type:'string',
                    message:'长度不能小于8'
                  }
                ]}
              /&gt;
            {/*  确认密码框*/}
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProFormText.Password</span>
                <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkPassword<span class="token punctuation">"</span></span>
                <span class="token attr-name">fieldProps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{</span>
                  <span class="token attr-name"><span class="token namespace">size:</span></span> <span class="token attr-name">'large',</span>
                  <span class="token attr-name"><span class="token namespace">prefix:</span></span> <span class="token attr-name">&lt;LockOutlined</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{styles.prefixIcon}</span> <span class="token punctuation">/&gt;</span></span>,
                }}
                // placeholder={'密码: ant.design'}
                placeholder={'请再次输⼊密码'}
                rules={[
                  {
                    required: true,
                    message: '确认密码是必填项！',
                  },
                  {
                    min:8,
                    type:'string',
                    message:'长度不能小于8'
                  }
                ]}
              /&gt;

            &lt;/&gt;
          )}


        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LoginForm</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  );
};
export default Register;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-修改用户登录态"><a href="#5-修改用户登录态" class="headerlink" title="5.修改用户登录态"></a>5.修改用户登录态</h2><p><img src="../images/鱼皮星球用户中心笔记/image-20230215114337482.png" alt="image-20230215114337482"></p>
<p>修改如下</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215114514748.png" alt="image-20230215114514748"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215114555568.png" alt="image-20230215114555568"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215114725917.png" alt="image-20230215114725917"></p>
<p>修改返回值</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215114900159.png" alt="image-20230215114900159"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215115722019.png" alt="image-20230215115722019"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215115705721.png" alt="image-20230215115705721"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215115754759.png" alt="image-20230215115754759"></p>
<p>完整的app.tsx如下：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">import Footer from '@/components/Footer';
import RightContent from '@/components/RightContent';
import { BookOutlined, LinkOutlined } from '@ant-design/icons';
import type { Settings as LayoutSettings } from '@ant-design/pro-components';
import { PageLoading, SettingDrawer } from '@ant-design/pro-components';
import type { RunTimeLayoutConfig } from 'umi';
import { history, Link } from 'umi';
import defaultSettings from '../config/defaultSettings';
import { currentUser as queryCurrentUser } from './services/ant-design-pro/api';

const isDev = process.env.NODE_ENV === 'development';
const loginPath = '/user/login';

/**
 * 无需用户登录态的页面
 */
const NO_NEED_LOGIN_WHITE_LIST = ['/user/register', loginPath];


import { RequestConfig } from 'umi';
export const request: RequestConfig = {
  timeout:10000
}

/** 获取用户信息比较慢的时候会展示一个 loading */
export const initialStateConfig = {
  loading: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageLoading</span> <span class="token punctuation">/&gt;</span></span>,
};

/**
 * @see  https://umijs.org/zh-CN/plugins/plugin-initial-state
 * */
export async function getInitialState(): Promise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>{</span>
  <span class="token attr-name"><span class="token namespace">settings?:</span></span> <span class="token attr-name">Partial&lt;LayoutSettings</span><span class="token punctuation">&gt;</span></span>;
  currentUser?: API.CurrentUser;
  loading?: boolean;
  fetchUserInfo?: () =&gt; Promise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>API.CurrentUser</span> <span class="token attr-name">|</span> <span class="token attr-name">undefined</span><span class="token punctuation">&gt;</span></span>;
}&gt; {
  const fetchUserInfo = async () =&gt; {
    try {
      // const msg = await queryCurrentUser();
      // return msg.data;
      return await queryCurrentUser();
    } catch (error) {
      // history.push(loginPath); 注释这行代码
    }
    return undefined;
  };
  // // 如果不是登录页面，执行
  // if (history.location.pathname !== loginPath) {
  //   const currentUser = await fetchUserInfo();
  //   return {
  //     fetchUserInfo,
  //     currentUser,
  //     settings: defaultSettings,
  //   };
  // }
  // return {
  //   fetchUserInfo,
  //   settings: defaultSettings,
  // };
  // 如果是无需登录的页面，不执行
  if (NO_NEED_LOGIN_WHITE_LIST.includes(history.location.pathname)) {
    return {
      // @ts-ignore
      fetchUserInfo,
      settings: defaultSettings,
    };
  }
  const currentUser = await fetchUserInfo();
  return {
    // @ts-ignore
    fetchUserInfo,
    currentUser,
    settings: defaultSettings,
  };

}

// ProLayout 支持的api https://procomponents.ant.design/components/layout
export const layout: RunTimeLayoutConfig = ({ initialState, setInitialState }) =&gt; {
  return {
    rightContentRender: () =&gt; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RightContent</span> <span class="token punctuation">/&gt;</span></span>,
    disableContentMargin: false,
    waterMarkProps: {
      // content: initialState?.currentUser?.name,
      content: initialState?.currentUser?.username,
    },
    footerRender: () =&gt; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/&gt;</span></span>,
    onPageChange: () =&gt; {
      const { location } = history;
      // 添加白名单，登录页面以及注册页面不需要进行强制路由
      // if(location.pathname === "/user/register"){
        if(NO_NEED_LOGIN_WHITE_LIST.includes(location.pathname)){
        return ;
      }
      // 如果没有登录，重定向到 login
      if (!initialState?.currentUser &amp;&amp; location.pathname !== loginPath) {
        history.push(loginPath);
      }
    },
    links: isDev
      ? [
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>openapi<span class="token punctuation">"</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/umi/plugin/openapi<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinkOutlined</span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>OpenAPI 文档<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">&gt;</span></span>,
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/~docs<span class="token punctuation">"</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>docs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BookOutlined</span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>业务组件文档<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">&gt;</span></span>,
        ]
      : [],
    menuHeaderRender: undefined,
    // 自定义 403 页面
    // unAccessible: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>unAccessible<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>,
    // 增加一个 loading 的状态
    childrenRender: (children, props) =&gt; {
      // if (initialState?.loading) return <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageLoading</span> <span class="token punctuation">/&gt;</span></span>;
      return (
        &lt;&gt;
          {children}
          {!props.location?.pathname?.includes('/login') &amp;&amp; (
            &lt;SettingDrawer
              disableUrlParams
              enableDarkTheme
              settings={initialState?.settings}
              onSettingChange={(settings) =&gt; {
                setInitialState((preInitialState) =&gt; ({
                  ...preInitialState,
                  settings,
                }));
              }}
            /&gt;
          )}
        &lt;/&gt;
      );
    },
    ...initialState?.settings,
  };
};
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6-显示用户头像和水印效果"><a href="#6-显示用户头像和水印效果" class="headerlink" title="6.显示用户头像和水印效果"></a>6.显示用户头像和水印效果</h2><p><img src="../images/鱼皮星球用户中心笔记/image-20230215120303248.png" alt="image-20230215120303248"></p>
<p>水印显示需要修改如下：</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215120457560.png" alt="image-20230215120457560"></p>
<p>显示用户名和用户头像</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215120926168.png" alt="image-20230215120926168"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215120749303.png" alt="image-20230215120749303"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215120952489.png" alt="image-20230215120952489"></p>
<h2 id="7-创建用户管理页面"><a href="#7-创建用户管理页面" class="headerlink" title="7.创建用户管理页面"></a>7.创建用户管理页面</h2><p>在page⽂件夹下新建Admin⽂件夹,，把user⽂件<br>夹下的Register⽂件夹复制，粘贴到admin⽂件夹下，并改名为UserMange</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215124738241.png" alt="image-20230215124738241"></p>
<p>去route.ts添加⼀个路由</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215124918851.png" alt="image-20230215124918851"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215125018783.png" alt="image-20230215125018783"></p>
<p>对⽐上⾯的/user ，发现/admin多了access: ‘canAdmin’ 也就是管理员才能访问</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215131523115.png" alt="image-20230215131523115"></p>
<p>access来⾃access.ts⽂件</p>
<blockquote>
<p>在Ant Design Pro（Umi 框架）中 access.ts 控制⽤户的访问权限</p>
</blockquote>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215131732881.png" alt="image-20230215131732881"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215131805872.png" alt="image-20230215131805872"></p>
<p>把⼆级管理页的路由删掉</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215131927907.png" alt="image-20230215131927907"></p>
<p>在api.ts 增加⼀个搜索⽤户的接⼝</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215133201784.png" alt="image-20230215133201784"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215133244685.png" alt="image-20230215133244685"></p>
<p>完整的用户管理页面如下：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">import React, { useRef } from 'react';
import type { ProColumns, ActionType } from '@ant-design/pro-table';
import ProTable, { TableDropdown } from '@ant-design/pro-table';
import {Image} from "antd";
import {searchUsers} from "@/services/ant-design-pro/api";

const columns: ProColumns<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>API.CurrentUser</span><span class="token punctuation">&gt;</span></span>[] = [
  {
    dataIndex: 'id',
    valueType: 'indexBorder',
    width: 48,
  },
  {
    title: '用户名',
    dataIndex: 'username',
    copyable: true,
  },
  {
    title: '用户账户',
    dataIndex: 'userAccount',
    copyable: true,
  },
  {
    title: '头像',
    dataIndex: 'avatarUrl',
    render: (_, record) =&gt; (
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{record.avatarUrl}</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{100}</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    ),
  },
  {
    title: '性别',
    dataIndex: 'gender',
  },
  {
    title: '电话',
    dataIndex: 'phone',
    copyable: true,
  },
  {
    title: '邮件',
    dataIndex: 'email',
    copyable: true,
  },
  {
    title: '状态',
    dataIndex: 'userStatus',
  },
  // {
  //   title: '星球编号',
  //   dataIndex: 'planetCode',
  // },
  {
    title: '角色',
    dataIndex: 'userRole',
    valueType: 'select',
    valueEnum: {
      0: { text: '普通用户', status: 'Default' },
      1: {
        text: '管理员',
        status: 'Success',
      },
    },
  },
  {
    title: '创建时间',
    dataIndex: 'createTime',
    valueType: 'dateTime',
  },
  {
    title: '操作',
    valueType: 'option',
    render: (text, record, _, action) =&gt; [
      &lt;a
        key="editable"
        onClick={() =&gt; {
          action?.startEditable?.(record.id);
        }}
      &gt;
        编辑
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>,
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{record.url}</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noopener noreferrer<span class="token punctuation">"</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>view<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        查看
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>,
      &lt;TableDropdown
        key="actionGroup"
        onSelect={() =&gt; action?.reload()}
        menus={[
          { key: 'copy', name: '复制' },
          { key: 'delete', name: '删除' },
        ]}
      /&gt;,
    ],
  },
];

export default () =&gt; {
  const actionRef = useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ActionType</span><span class="token punctuation">&gt;</span></span>();
  return (
    &lt;ProTable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>API.CurrentUser</span><span class="token punctuation">&gt;</span></span>
      columns={columns}
      actionRef={actionRef}
      cardBordered
      request={async (params = {}, sort, filter) =&gt; {
        console.log(sort, filter);
        const userList = await searchUsers();
        return {
          data: userList
        }
      }}
      editable={{
        type: 'multiple',
      }}
      columnsState={{
        persistenceKey: 'pro-table-singe-demos',
        persistenceType: 'localStorage',
      }}
      rowKey="id"
      search={{
        labelWidth: 'auto',
      }}
      form={{
        // 由于配置了 transform，提交的参与与定义的不同这里需要转化一下
        syncToUrl: (values, type) =&gt; {
          if (type === 'get') {
            return {
              ...values,
              created_at: [values.startTime, values.endTime],
            };
          }
          return values;
        },
      }}
      pagination={{
        pageSize: 5,
      }}
      dateFormatter="string"
      headerTitle="高级表格"
    /&gt;
  );
};
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215133458662.png" alt="image-20230215133458662"></p>
<h2 id="8-用户注销"><a href="#8-用户注销" class="headerlink" title="8.用户注销"></a>8.用户注销</h2><p><img src="../images/鱼皮星球用户中心笔记/image-20230215142122207.png" alt="image-20230215142122207"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215142153375.png" alt="image-20230215142153375"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215142535833.png" alt="image-20230215142535833"></p>
<p>验证的话，只需注销后，点击网页的返回，看会不会返回后台页面，返回登录页面的话就是成功了。</p>
<p>这里前端的用户注销就做完了。</p>
<h2 id="9-添加注册字段（星球编号）"><a href="#9-添加注册字段（星球编号）" class="headerlink" title="9.添加注册字段（星球编号）"></a>9.添加注册字段（星球编号）</h2><p>前端添加planetCode的输入框，放到确认密码后面</p>
<p>复制一下账号输入框修改就行了</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215144136616.png" alt="image-20230215144136616"></p>
<p>再去修改一下前端提交给后端的数据类型，需要找到RegisterParams 添加planetCode字段</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215144333460.png" alt="image-20230215144333460"></p>
<p>后端user新增了字段，前端的CurrentUser也是需要的</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215144444587.png" alt="image-20230215144444587"></p>
<p>前端admin的用户查询也需要修改</p>
<p>在前端展示页添加planetCode</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215144548015.png" alt="image-20230215144548015"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230215144826651.png" alt="image-20230215144826651"></p>
<h2 id="10-前端多环境实战-部署前的准备"><a href="#10-前端多环境实战-部署前的准备" class="headerlink" title="10.前端多环境实战(部署前的准备)"></a>10.前端多环境实战(部署前的准备)</h2><h3 id="多环境"><a href="#多环境" class="headerlink" title="多环境"></a>多环境</h3><p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41701290/article/details/120173283">https://blog.csdn.net/weixin_41701290/article/details/120173283</a></p>
<p>(这个链接里面鱼皮讲的非常的清楚！（￣︶￣）↗　)</p>
<p>本地开发：<code>localhost（127.0.0.1）</code></p>
<p>多环境：指同一套项目代码在不同的阶段需要根据实际情况来调整配置并且部署到不同的机器上。</p>
<p>为什么需要？</p>
<ol>
<li><p>每个环境互不影响</p>
</li>
<li><p>区分不同的阶段：开发 / 测试 / 生产</p>
</li>
<li><p>对项目进行优化：</p>
<pre><code> 1. 本地日志级别
    2. 精简依赖，节省项目体积
    3. 项目的环境 / 参数可以调整，比如 JVM 参数
</code></pre></li>
</ol>
<p>针对不同环境做不同的事情。</p>
<p>多环境分类：</p>
<ol>
<li>本地环境（自己的电脑）<code>localhost</code></li>
<li>开发环境（远程开发）大家连同一台机器，为了大家开发方便</li>
<li>测试环境（测试）开发 / 测试 / 产品，单元测试 / 性能测试 / 功能测试 / 系统集成测试，独立的数据库、独立的服务器</li>
<li>预发布环境（体验服）：和正式环境一致，正式数据库，更严谨，查出更多问题</li>
<li>正式环境（线上，公开对外访问的项目）：尽量不要改动，保证上线前的代码是 “完美” 运行</li>
<li>沙箱环境（实验环境）：为了做实验</li>
</ol>
<ul>
<li><p>请求地址 </p>
</li>
<li><ul>
<li>开发环境：<code>localhost:8000</code></li>
<li>线上环境：<code>user-backend.code-nav.cn</code></li>
</ul>
</li>
</ul>
<p><strong>用了 umi 框架，build 时会自动传入 NODE_ENV == production 参数，start    NODE_ENV 参数为 development</strong> </p>
<ul>
<li><p>启动方式 </p>
</li>
<li><ul>
<li>开发环境：<code>npm run start</code>（本地启动，监听端口、自动更新）</li>
<li>线上环境：<code>npm run build</code>（项目构建打包），可以使用 <code>serve</code> 工具启动（<code>npm i -g serve</code>进行安装<code>serve</code>）</li>
</ul>
</li>
<li><p>项目的配置<br>不同的项目（框架）都有不同的配置文件，<code>umi</code> 的配置文件是 <code>config</code>，可以在配置文件后添加对应的环境名称后缀来区分开发环境和生产环境。参考文档：<a target="_blank" rel="noopener" href="https://umijs.org/zh-CN/docs/deployment">https://umijs.org/zh-CN/docs/deployment</a> </p>
</li>
<li><ul>
<li>开发环境：<code>config.dev.ts</code></li>
<li>生产环境：<code>config.prod.ts</code></li>
<li>公共配置：<code>config.ts</code> 不带后缀</li>
</ul>
</li>
</ul>
<p>验证本地<code>start</code>启动的项目运行的环境</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219210006552.png" alt="image-20230219210006552"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219210204168.png" alt="image-20230219210204168"></p>
<p>如果要进行项目上线的话，需要运行<code>build</code> 进行打包构建，然后生成一个<code>dist</code>文件</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219210342105.png" alt="image-20230219210342105"></p>
<p> 可以使用 <code>serve</code> 工具启动（<code>npm i -g serve</code>），浏览打包好了的文件</p>
<p>（在<code>dist</code>文件下运行是网页，在<code>MyCenterApp</code>文件下运行<code>serve</code>是浏览文件夹目录）</p>
<p>之前不是写过一个<code>alert</code>去看运行环境吗？这里的运行环境是<code>production</code>，是<code>umi</code>在<code>build</code>之后自己修改的。</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219210627758.png" alt="image-20230219210627758"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219210828182.png" alt="image-20230219210828182"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219211152234.png" alt="image-20230219211152234"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219212054359.png" alt="image-20230219212054359"></p>
<h2 id="11-前端部署"><a href="#11-前端部署" class="headerlink" title="11.前端部署"></a>11.前端部署</h2><p>需要 <code>web</code> 服务器：<strong>nginx</strong> 、apache、tomcat,推荐使用nginx     Nginx 的三种安装方式：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/425790769">https://zhuanlan.zhihu.com/p/425790769</a></p>
<p>安装 nginx 服务器：</p>
<ol>
<li>用系统自带的软件包管理器快速安装，比如 centos 的 yum （推荐使用）</li>
<li>自己到官网安装（参考本文章）（比较繁琐） </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看当前所在目录</span>
<span class="token builtin class-name">pwd</span>
<span class="token comment"># 创建services目录，用来存放所有项目的依赖和安装包</span>
<span class="token function">mkdir</span> services
<span class="token comment"># 列出当前目录下所有的 文件和文件夹</span>
<span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219212707368.png" alt="image-20230219212707368"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 把之前的mysql的安装包移动到services目录中</span>
<span class="token function">mv</span> mysql-community-release-el7-5.noarch.rpm /root/services
<span class="token comment"># 进入到services目录中</span>
<span class="token builtin class-name">cd</span> services/
<span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219212915371.png" alt="image-20230219212915371"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 把nginx安装包下载下来，并改名为nginx-1.20.2.tar.gz</span>
<span class="token function">curl</span> <span class="token parameter variable">-o</span> nginx-1.20.2.tar.gz http://nginx.org/download/nginx-1.20.2.tar.gz
<span class="token comment"># 解压nginx</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> nginx-1.20.2.tar.gz
<span class="token comment"># 进入到nginx目录中</span>
<span class="token builtin class-name">cd</span> nginx-1.20.2

<span class="token function">ls</span>
<span class="token comment"># 安装相关依赖</span>
yum <span class="token function">install</span> pcre pcre-devel <span class="token parameter variable">-y</span>
yum <span class="token function">install</span> openssl openssl-devel <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219214009926.png" alt="image-20230219214009926"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 设置系统配置参数</span>
./configure --with-http_ssl_module --with-http_v2_module --with-stream
<span class="token comment"># 开始编译</span>
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
<span class="token comment"># 输入nginx，会报错，说找不到命令，需要加入环境变量</span>
nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219214258130.png" alt="image-20230219214258130"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/profile
<span class="token comment">#  按下shift+g将光标定位到最后一行，新增以下内容：</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/nginx/sbin
<span class="token comment"># 使配置文件生效</span>
<span class="token builtin class-name">source</span> /etc/profile
nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219214541659.png" alt="image-20230219214541659"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看当前所有tcp端口/查看启动情况</span>
<span class="token function">netstat</span> <span class="token parameter variable">-ntlp</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219214644217.png" alt="image-20230219214644217"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 复制nginx.conf配置文件.并重命名为nginx.default.conf</span>
<span class="token builtin class-name">cd</span> /usr/local/nginx/conf
<span class="token function">cp</span> nginx.conf nginx.default.conf
<span class="token comment"># 查看nginx.conf整个文件内容</span>
<span class="token function">cat</span> nginx.conf
<span class="token comment"># 上传dist文件到/root/services中</span>
<span class="token comment"># 切换目录到/root/services</span>
<span class="token builtin class-name">cd</span> /root/services
<span class="token comment"># 解压 dist.zip</span>
<span class="token function">unzip</span> dist.zip
<span class="token comment"># 重命名为 user-center-front</span>
<span class="token function">mv</span> dist user-center-front<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219221026515.png" alt="image-20230219221026515"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#修改配置文件，设置启动用户和前端项目所在路径</span>
<span class="token builtin class-name">cd</span> /usr/local/nginx/conf
<span class="token function">vim</span> nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">location / <span class="token punctuation">{</span>
    root   html<span class="token punctuation">;</span>
    index  index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

改为如下：
location / <span class="token punctuation">{</span>
    root  /root/services/user-center-front<span class="token punctuation">;</span>
    index  index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219221523332.png" alt="image-20230219221523332"></p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219221633452.png" alt="image-20230219221633452"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 更新配置</span>
nginx <span class="token parameter variable">-s</span> reload
<span class="token comment"># 在云服务器网站开放80端口,还要在防火墙 手动增加80端口</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 防火墙重新加载配置</span>
firewall-cmd <span class="token parameter variable">--reload</span>
<span class="token comment"># 查看开放的端口</span>
firewall-cmd --list-ports<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219221955371.png" alt="image-20230219221955371"></p>
<p>测试访问公网ip地址</p>
<p><img src="../images/鱼皮星球用户中心笔记/image-20230219222045009.png" alt="image-20230219222045009"></p>
<p>前端部署完毕！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://RanGuMo.github.io">RanGuMo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://rangumo.github.io/2022/03/11/yu-pi-xing-qiu-yong-hu-zhong-xin-bi-ji/">http://rangumo.github.io/2022/03/11/yu-pi-xing-qiu-yong-hu-zhong-xin-bi-ji/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://RanGuMo.github.io" target="_blank">墨苒孤</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE/">前端项目</a></div><div class="post_share"><div class="social-share" data-image="https://source.fomal.cc/img/dm7.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">RanGuMo</div><div class="author-info__description">墨苒孤</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/RanGuMo"><i></i><span>🛴前往小家...</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/RanGuMo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1126146235@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">1.初始化项目（前端项目）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E7%98%A6%E8%BA%AB"><span class="toc-number">2.</span> <span class="toc-text">2.项目瘦身</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.</span> <span class="toc-text">3.登录页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B3%A8%E5%86%8C%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">4.注册页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%80%81"><span class="toc-number">5.</span> <span class="toc-text">5.修改用户登录态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%98%BE%E7%A4%BA%E7%94%A8%E6%88%B7%E5%A4%B4%E5%83%8F%E5%92%8C%E6%B0%B4%E5%8D%B0%E6%95%88%E6%9E%9C"><span class="toc-number">6.</span> <span class="toc-text">6.显示用户头像和水印效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="toc-number">7.</span> <span class="toc-text">7.创建用户管理页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%94%A8%E6%88%B7%E6%B3%A8%E9%94%80"><span class="toc-number">8.</span> <span class="toc-text">8.用户注销</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%B7%BB%E5%8A%A0%E6%B3%A8%E5%86%8C%E5%AD%97%E6%AE%B5%EF%BC%88%E6%98%9F%E7%90%83%E7%BC%96%E5%8F%B7%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">9.添加注册字段（星球编号）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%89%8D%E7%AB%AF%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%AE%9E%E6%88%98-%E9%83%A8%E7%BD%B2%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87"><span class="toc-number">10.</span> <span class="toc-text">10.前端多环境实战(部署前的准备)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%8E%AF%E5%A2%83"><span class="toc-number">10.1.</span> <span class="toc-text">多环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%89%8D%E7%AB%AF%E9%83%A8%E7%BD%B2"><span class="toc-number">11.</span> <span class="toc-text">11.前端部署</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By RanGuMo</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/light.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://www.fomal.cc/static/js/runtime.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/12/30/hexo-wen-zhang-zhong-ru-he-fang-ru-tu-pian/" alt=""><img width="48" height="48" src="https://source.fomal.cc/img/dm2.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-30</span><a class="blog-slider__title" href="2022/12/30/hexo-wen-zhang-zhong-ru-he-fang-ru-tu-pian/" alt="">hexo文章中如何放入图片？</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/12/30/hexo-wen-zhang-zhong-ru-he-fang-ru-tu-pian/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/12/06/mongodb-xue-xi/" alt=""><img width="48" height="48" src="https://source.fomal.cc/img/dm5.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-06</span><a class="blog-slider__title" href="2022/12/06/mongodb-xue-xi/" alt="">MongoDB学习</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/12/06/mongodb-xue-xi/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2022/12/04/javascript-xue-xi/" alt=""><img width="48" height="48" src="https://source.fomal.cc/img/dm1.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-04</span><a class="blog-slider__title" href="2022/12/04/javascript-xue-xi/" alt="">JavaScript学习</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2022/12/04/javascript-xue-xi/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>